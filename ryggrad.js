/* Ryggrad v0.0.1 - 2013/10/16
   http://ryggrad.github.io
   Copyright (c) 2013 K-2052 - Licensed under MIT */
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++){if(b in this&&this[b]===a)return b}return-1},V=[].slice,W={}.hasOwnProperty,X=function(a,b){for(var c in b){if(W.call(b,c))a[c]=b[c]}function d(){this.constructor=a}d.prototype=b.prototype;a.prototype=new d;a.__super__=b.prototype;return a},Y=function(a,b){return function(){return a.apply(b,arguments)}};p={};p.version="0.0.1";H=typeof exports!=="undefined"&&exports!==null?exports:this;H.Ryggrad=p;p.Util=function(){function a(){}a.prototype.getInputValue=function(a){var b,c,d,e;if(window.jQuery!=null){switch(a[0].type){case"checkbox":return a.is(":checked");default:return a.val()}}else{switch(a.type){case"checkbox":return a.checked;case"select-multiple":e=[];for(c=0,d=a.length;c<d;c++){b=a[c];if(b.selected){e.push(b.value)}}return e;break;default:return a.value}}};return a}();B=window.jQuery||window.Zepto;a=B;a.fn.extend({hasEvent:function(b,c,d){var e,f,g,h,i;e=0;g=typeof b;h=false;d=d?d:this;b=g==="string"?a.trim(b):b;if(g==="function"){c=b;b=null}if(c===d){c=null}f=d.data("events");for(i in f){if(f.hasOwnProperty(i)){e++}}if(e<1){return h=false}if(b&&!c){return h=f.hasOwnProperty(b)}else if(b&&f.hasOwnProperty(b)&&c){a.each(f[b],function(a,b){if(h===false&&b.handler===c){return h=true}});return h}else if(!b&&c){a.each(f,function(b,d){if(h===false){return a.each(d,function(a,b){if(h===false&&b.handler===c){return h=true}})}})}return h}});a.extend(a.fn.hasEvent);if(typeof Object.create!=="function"){Object.create=function(a){var b;b=function(){};b.prototype=a;return new b}}z=function(a){return Object.prototype.toString.call(a)==="[object Array]"};A=function(a){var b;if(!a){return true}for(b in a){return false}return true};C=function(a){return Array.prototype.slice.call(a,0)};E=["included","extended"];n=function(){a.include=function(a){var b,c,d;if(!a){throw new Error("include(obj) requires obj")}for(c in a){d=a[c];if(U.call(E,c)<0){this.prototype[c]=d}}b=a.included;if(b){b.apply(this)}return this};a.extend=function(a){var b,c,d;if(!a){throw new Error("extend(obj) requires obj")}for(b in a){c=a[b];if(U.call(E,b)<0){this[b]=c}}if((d=a.extended)!=null){d.apply(this)}return this};a.proxy=function(a){var b=this;return function(){return a.apply(b,arguments)}};a.prototype.proxy=function(a){var b=this;return function(){return a.apply(b,arguments)}};a.prototype.delay=function(a,b){return setTimeout(this.proxy(a),b||0)};function a(){if(typeof this.init==="function"){this.init(arguments)}}return a}();n.create=function(){var a,b,c,d;b=arguments[0],c=2<=arguments.length?V.call(arguments,1):[];if(!b){b=this}a=function(a){var b,e,f,g,h;X(i,a);function i(){d=i.__super__.constructor.apply(this,arguments);return d}for(g=c.length-1;g>=0;g+=-1){e=c[g];h=e.prototype;for(f in h){b=h[f];i.prototype[f]=b}}return i}(b);return a};p.Module=n;i={bind:function(a,b){var c,d,e,f,g;d=a.split(" ");c=this.hasOwnProperty("_callbacks")&&this._callbacks||(this._callbacks={});for(f=0,g=d.length;f<g;f++){e=d[f];c[e]||(c[e]=[]);c[e].push(b)}return this},trigger:function(){var a,b,c,d,e,f,g;a=1<=arguments.length?V.call(arguments,0):[];c=a.shift();d=this.hasOwnProperty("_callbacks")&&((g=this._callbacks)!=null?g[c]:void 0);if(!d){return}for(e=0,f=d.length;e<f;e++){b=d[e];if(b.apply(this,a)===false){break}}return true},listenTo:function(a,b,c){a.bind(b,c);this.listeningTo||(this.listeningTo=[]);this.listeningTo.push({obj:a,ev:b,callback:c});return this},listenToOnce:function(a,b,c){var d,e;e=this.listeningToOnce||(this.listeningToOnce=[]);a.bind(b,d=function(){var f,g,h,i,j;g=-1;for(f=i=0,j=e.length;i<j;f=++i){h=e[f];if(h.obj===a){if(h.ev===b&&h.callback===c){g=f}}}a.unbind(b,d);if(g!==-1){e.splice(g,1)}return c.apply(this,arguments)});e.push({obj:a,ev:b,callback:c,handler:d});return this},stopListening:function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(arguments.length===0){q=[this.listeningTo,this.listeningToOnce];for(k=0,n=q.length;k<n;k++){i=q[k];if(!i){continue}for(l=0,o=i.length;l<o;l++){j=i[l];j.obj.unbind(j.ev,j.handler||j.callback)}}this.listeningTo=void 0;return this.listeningToOnce=void 0}else if(b){r=[this.listeningTo,this.listeningToOnce];s=[];for(m=0,p=r.length;m<p;m++){i=r[m];if(!i){continue}c=c?c.split(" "):[void 0];s.push(function(){var b,d,k;k=[];for(b=0,d=c.length;b<d;b++){e=c[b];k.push(function(){var b,c,d;d=[];for(h=b=c=i.length-1;c<=0?b<=0:b>=0;h=c<=0?++b:--b){j=i[h];if(!e||e===j.ev){j.obj.unbind(j.ev,j.handler||j.callback);if(h!==-1){d.push(i.splice(h,1))}else{d.push(void 0)}}else if(e){f=j.ev.split(" ");if(~(g=f.indexOf(e))){f.splice(g,1);j.ev=a.trim(f.join(" "));d.push(j.obj.unbind(e,j.handler||j.callback))}else{d.push(void 0)}}else{d.push(void 0)}}return d}())}return k}())}return s}},unbind:function(a,b){var c,d,e,f,g,h;if(!a){this._callbacks={};return this}e=(h=this._callbacks)!=null?h[a]:void 0;if(!e){return this}if(!b){delete this._callbacks[a];return this}for(d=f=0,g=e.length;f<g;d=++f){c=e[d];if(!(c===b)){continue}e=e.slice();e.splice(d,1);this._callbacks[a]=e;break}return this}};p.Events=i;p.Module.extend.call(p,i);p.Model=function(a){X(b,a);b.extend(p.Events);b.records=[];b.irecords={};b.attributes=[];b.configure=function(){var a,b;b=arguments[0],a=2<=arguments.length?V.call(arguments,1):[];this.className=b;this.deleteAll();if(a.length){this.attributes=a}this.attributes&&(this.attributes=C(this.attributes));this.attributes||(this.attributes=[]);this.unbind();return this};b.toString=function(){return""+this.className+"("+this.attributes.join(", ")+")"};b.create=function(a,b){var c;c=new this(a);return c.save(b)};b.exists=function(a){var b;return(b=this.irecords[a])!=null?b.clone():void 0};b.find=function(a){var b;b=this.exists(a);if(!b){throw new Error('"'+this.className+'" model could not find a record for the ID "'+a+'"')}return b};b.update=function(a,b,c){return this.find(a).updateAttributes(b,c)};b.destroy=function(a,b){return this.find(a).destroy(b)};b.fetch=function(a){if(typeof a==="function"){return this.bind("fetch",a)}else{return this.trigger.apply(this,["fetch"].concat(V.call(arguments)))}};b.change=function(a){if(typeof a==="function"){return this.bind("change",a)}else{return this.trigger.apply(this,["change"].concat(V.call(arguments)))}};b.addRecord=function(a){if(a.id&&this.irecords[a.id]){this.irecords[a.id].remove()}a.id||(a.id=a.uid);this.records.push(a);this.irecords[a.id]=a;return this.irecords[a.uid]=a};b.deleteAll=function(){this.records=[];return this.irecords={}};b.refresh=function(a,b){var c,d,e,f,g;if(b==null){b={}}if(b.clear){this.deleteAll()}d=this.fromJSON(a);if(!z(d)){d=[d]}for(f=0,g=d.length;f<g;f++){c=d[f];this.addRecord(c)}this.sort();e=this.cloneArray(d);this.trigger("refresh",e,b);return e};b.toJSON=function(){return this.records};b.fromJSON=function(a){var b,c,d,e;if(!a){return}if(typeof a==="string"){a=JSON.parse(a)}if(z(a)){e=[];for(c=0,d=a.length;c<d;c++){b=a[c];e.push(new this(b))}return e}else{return new this(a)}};b.sort=function(){if(this.comparator){this.records.sort(this.comparator)}return this};b.findBy=function(a,b){var c,d,e,f;f=this.records;for(d=0,e=f.length;d<e;d++){c=f[d];if(c[a]===b){return c.clone()}}return null};b.findAllBy=function(a,b){return this.select(function(c){return c[a]===b})};b.select=function(a){var b,c,d,e,f;e=this.records;f=[];for(c=0,d=e.length;c<d;c++){b=e[c];if(a(b)){f.push(b.clone())}}return f};b.each=function(a){var b,c,d,e,f;e=this.records;f=[];for(c=0,d=e.length;c<d;c++){b=e[c];f.push(a(b.clone()))}return f};b.all=function(){return this.cloneArray(this.records)};b.first=function(){var a;return(a=this.records[0])!=null?a.clone():void 0};b.last=function(){var a;return(a=this.records[this.records.length-1])!=null?a.clone():void 0};b.count=function(){return this.records.length};b.recordsValues=function(){var a,b,c,d;b=[];d=this.records;for(a in d){c=d[a];b.push(c)}return b};b.destroyAll=function(a){var b,c,d,e,f;e=this.records;f=[];for(c=0,d=e.length;c<d;c++){b=e[c];f.push(b.destroy(a))}return f};b.cloneArray=function(a){var b,c,d,e;e=[];for(c=0,d=a.length;c<d;c++){b=a[c];e.push(b.clone())}return e};b.idCounter=0;b.uid=function(a){var b;if(a==null){a=""}b=a+this.idCounter++;if(this.exists(b)){b=this.uid(a)}return b};function b(a){b.__super__.constructor.apply(this,arguments);this.className=this.constructor.name;if(a){this.load(a)}this.uid=(typeof atts!=="undefined"&&atts!==null?atts.uid:void 0)||this.constructor.uid("uid-")}b.prototype.isNew=function(){return!this.exists()};b.prototype.isValid=function(){return!this.validate()};b.prototype.validate=function(){};b.prototype.load=function(a){var b,c;if(a.id){this.id=a.id}for(b in a){c=a[b];if(a.hasOwnProperty(b)&&typeof this[b]==="function"){this[b](c)}else{this[b]=c}}return this};b.prototype.attributes=function(){var a,b,c,d,e;b={};e=this.constructor.attributes;for(c=0,d=e.length;c<d;c++){a=e[c];if(a in this){if(typeof this[a]==="function"){b[a]=this[a]()}else{b[a]=this[a]}}}if(this.id){b.id=this.id}return b};b.prototype.eql=function(a){return!!(a&&a.constructor===this.constructor&&(a.uid===this.uid||a.id&&a.id===this.id))};b.prototype.save=function(a){var b,c;if(a==null){a={}}if(a.validate!==false){b=this.validate();if(b){this.trigger("error",b);return false}}this.trigger("beforeSave",a);c=this.isNew()?this.create(a):this.update(a);this.stripCloneAttrs();this.trigger("save",a);return c};b.prototype.stripCloneAttrs=function(){var a,b;if(this.hasOwnProperty("uid")){return}for(a in this){if(!W.call(this,a))continue;b=this[a];if(this.constructor.attributes.indexOf(a)>-1){delete this[a]}}return this};b.prototype.updateAttribute=function(a,b,c){var d;d={};d[a]=b;return this.updateAttributes(d,c)};b.prototype.updateAttributes=function(a,b){this.load(a);return this.save(b)};b.prototype.changeID=function(a){var b;if(a===this.id){return}b=this.constructor.irecords;b[a]=b[this.id];delete b[this.id];this.id=a;return this.save()};b.prototype.changeUID=function(a){var b;b=this.constructor.irecords;b[a]=b[this.uid];delete b[this.uid];this.uid=a;return this.save()};b.prototype.remove=function(){var a,b,c,d,e;c=this.constructor.records.slice(0);for(a=d=0,e=c.length;d<e;a=++d){b=c[a];if(!this.eql(b)){continue}c.splice(a,1);break}this.constructor.records=c;delete this.constructor.irecords[this.id];return delete this.constructor.irecords[this.uid]};b.prototype.destroy=function(a){if(a==null){a={}}this.trigger("beforeDestroy",a);this.remove();this.destroyed=true;this.trigger("destroy",a);this.trigger("change","destroy",a);if(this.listeningTo){this.stopListening()}this.unbind();return this};b.prototype.dup=function(a){var b;if(a==null){a=true}b=this.attributes();if(a){delete b.id}else{b.uid=this.uid}return new this.constructor(b)};b.prototype.clone=function(){return Object.create(this)};b.prototype.reload=function(){var a;if(this.isNew()){return this}a=this.constructor.find(this.id);this.load(a.attributes());return a};b.prototype.refresh=function(a){H=this.constructor.irecords[this.id];H.load(a);this.trigger("refresh");return this};b.prototype.exists=function(){return this.constructor.exists(this.id)};b.prototype.update=function(a){var b,c;this.trigger("beforeUpdate",a);c=this.constructor.irecords;c[this.id].load(this.attributes());this.constructor.sort();b=c[this.id].clone();b.trigger("update",a);b.trigger("change","update",a);return b};b.prototype.create=function(a){var b,c;this.trigger("beforeCreate",a);this.id||(this.id=this.uid);c=this.dup(false);this.constructor.addRecord(c);this.constructor.sort();b=c.clone();b.trigger("create",a);b.trigger("change","create",a);return b};b.prototype.bind=function(a,b){var c,d,e,f,g,h,i=this;this.constructor.bind(a,c=function(a){if(a&&i.eql(a)){return b.apply(i,arguments)}});h=a.split(" ");e=function(a){var d;return i.constructor.bind("unbind",d=function(e,f,g){if(e&&i.eql(e)){if(f&&f!==a){return}if(g&&g!==b){return}i.constructor.unbind(a,c);return i.constructor.unbind("unbind",d)}})};for(f=0,g=h.length;f<g;f++){d=h[f];e(d)}return this};b.prototype.one=function(a,b){var c,d=this;return this.bind(a,c=function(){d.unbind(a,c);return b.apply(d,arguments)})};b.prototype.trigger=function(){var a,b;a=1<=arguments.length?V.call(arguments,0):[];a.splice(1,0,this);return(b=this.constructor).trigger.apply(b,a)};b.prototype.listenTo=function(){return p.Events.listenTo.apply(this,arguments)};b.prototype.listenToOnce=function(){return p.Events.listenToOnce.apply(this,arguments)};b.prototype.stopListening=function(){return p.Events.stopListening.apply(this,arguments)};b.prototype.unbind=function(a,b){var c,d,e,f,g;if(arguments.length===0){return this.trigger("unbind")}else if(a){f=a.split(" ");g=[];for(d=0,e=f.length;d<e;d++){c=f[d];g.push(this.trigger("unbind",c,b))}return g}};b.prototype.toJSON=function(){return this.attributes()};b.prototype.toString=function(){return"<"+this.constructor.className+" ("+JSON.stringify(this)+")>"};return b}(p.Module);p.Model.setup=function(a,b){var c,d;if(b==null){b=[]}c=function(a){X(b,a);function b(){d=b.__super__.constructor.apply(this,arguments);return d}return b}(this);c.configure.apply(c,[a].concat(V.call(b)));return c};if(typeof require==="function"){a=B=require("jquery")}else{a=B=window.jQuery}u="a abbr address article aside audio b bdi bdo blockquote body button   canvas caption cite code colgroup datalist dd del details dfn div dl dt em   fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 head header hgroup   html i iframe ins kbd label legend li map mark menu meter nav noscript object   ol optgroup option output p pre progress q rp rt ruby s samp script section   select small span strong style sub summary sup table tbody td textarea tfoot   th thead time title tr u ul video area base br col command embed hr img input   keygen link meta param source track wbrk".split(/\s+/);L="area base br col command embed hr img input keygen link meta param   source track wbr".split(/\s+/);w="blur change click dblclick error focus input keydown   keypress keyup load mousedown mousemove mouseout mouseover   mouseup resize scroll select submit unload".split(/\s+/);y=0;r=function(b){X(c,b);c.prototype.model=null;c.builderStack=[];u.forEach(function(a){return c[a]=function(){var b,c;b=1<=arguments.length?V.call(arguments,0):[];return(c=this.currentBuilder).tag.apply(c,[a].concat(V.call(b)))}});c.subview=function(a,b){return this.currentBuilder.subview(a,b)};c.text=function(a){return this.currentBuilder.text(a)};c.tag=function(){var a,b,c;b=arguments[0],a=2<=arguments.length?V.call(arguments,1):[];return(c=this.currentBuilder).tag.apply(c,[b].concat(V.call(a)))};c.raw=function(a){return this.currentBuilder.raw(a)};c.pushBuilder=function(){var a;a=new e;this.builderStack.push(a);return this.currentBuilder=a};c.popBuilder=function(){this.currentBuilder=this.builderStack[this.builderStack.length-2];return this.builderStack.pop()};c.buildHtml=function(a){var b,c,d;this.pushBuilder();a.call(this);return d=this.popBuilder().buildHtml(),b=d[0],c=d[1],d};c.render=function(b){var c,d,e,f,g,h,i,j;j=this.buildHtml(b),e=j[0],f=j[1];c=document.createElement("div");c.innerHTML=e;d=a(c.childNodes);for(h=0,i=f.length;h<i;h++){g=f[h];g(d)}return d};function c(){var a,b,c,d,e,f,g;a=1<=arguments.length?V.call(arguments,0):[];g=this.constructor.buildHtml(function(){return this.content.apply(this,a)}),b=g[0],c=g[1];B.fn.init.call(this,b);if(this.length!==1){throw new Error("View markup must have a single root element")}this.wireOutlets(this);this.bindEventHandlers(this);this.find("*").andSelf().data("view",this);this.attr("callAttachHooks",true);for(e=0,f=c.length;e<f;e++){d=c[e];d(this)}if(typeof this.initialize==="function"){this.initialize.apply(this,a)}}c.prototype.setModel=function(a){this.model=a;if(this.model){return this.bindModelEvents()}};c.prototype.buildHtml=function(a){var b,c,d;this.constructor.builder=new e;this.constructor.content(a);d=this.constructor.builder.buildHtml(),b=d[0],c=d[1];this.constructor.builder=null;return c};c.prototype.wireOutlets=function(b){return this.find("[outlet]").each(function(){var c,d;c=a(this);d=c.attr("outlet");b[d]=c;return c.attr("outlet",null)})};c.prototype.bindEventHandlers=function(b){var c,d,e,f,g;g=[];for(e=0,f=w.length;e<f;e++){c=w[e];d="["+c+"]";u=b.find(d).add(b.filter(d));g.push(u.each(function(){var d,e;d=a(this);e=d.attr(c);return d.on(c,function(a){return b[e](a,d)})}))}return g};c.prototype.bindModelEvents=function(){var a,b,c,d;c=this.constructor.model_events;d=[];for(a in c){b=c[a];d.push(this.model.bind(a,this[b]))}return d};c.prototype.pushStack=function(a){var b;b=B.merge(B(),a);b.prevObject=this;b.context=this.context;return b};c.prototype.end=function(){var a;return(a=this.prevObject)!=null?a:B(null)};return c}(B);e=function(){function a(){this.document=[];this.postProcessingSteps=[]}a.prototype.buildHtml=function(){return[this.document.join(""),this.postProcessingSteps]};a.prototype.tag=function(){var a,b,c;b=arguments[0],a=2<=arguments.length?V.call(arguments,1):[];c=this.extractOptions(a);this.openTag(b,c.attributes);if(U.call(L,b)>=0){if(c.text!=null||c.content!=null){throw new Error("Self-closing tag "+b+" cannot have text or content")}}else{if(typeof c.content==="function"){c.content()}if(c.text){this.text(c.text)}return this.closeTag(b)}};a.prototype.openTag=function(a,b){var c,d,e,f;d=function(){var a;a=[];for(c in b){f=b[c];a.push(""+c+'="'+f+'"')}return a}();e=d.length?" "+d.join(" "):"";return this.document.push("<"+a+e+">")};a.prototype.closeTag=function(a){return this.document.push("</"+a+">")};a.prototype.text=function(a){var b;b=a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return this.document.push(b)};a.prototype.raw=function(a){return this.document.push(a)};a.prototype.subview=function(a,b){var c;c="subview-"+ ++y;this.tag("div",{id:c});return this.postProcessingSteps.push(function(d){d[a]=b;b.parentView=d;return d.find("div#"+c).replaceWith(b)})};a.prototype.extractOptions=function(a){var b,c,d,e,f;c={};for(e=0,f=a.length;e<f;e++){b=a[e];d=typeof b;if(d==="function"){c.content=b}else if(d==="string"||d==="number"){c.text=b.toString()}else{c.attributes=b}}return c};return a}();B.fn.view=function(){return this.data("view")};B.fn.views=function(){return this.toArray().map(function(b){return a(b).view()})};t=function(b){var c,d,e,f,g,h,i;if(!b){return}d=(typeof b.parents==="function"?b.parents("html").length:void 0)>0;c=[];if(typeof b.attr==="function"?b.attr("callAttachHooks"):void 0){c.push(b[0])}if(d){c=c.concat((g=typeof b.find==="function"?b.find("[callAttachHooks]").toArray():void 0)!=null?g:[])}i=[];for(e=0,f=c.length;e<f;e++){b=c[e];i.push((h=a(b).view())!=null?typeof h.afterAttach==="function"?h.afterAttach(d):void 0:void 0)}return i};S=["append","prepend","after","before"];M=function(b){var c;c=a.fn[b];return B.fn[b]=function(){var a,b,d,e,f,g,h;b=1<=arguments.length?V.call(arguments,0):[];d=(h=[]).concat.apply(h,b);e=c.apply(this,d);for(f=0,g=d.length;f<g;f++){a=d[f];t(a)}return e}};for(O=0,Q=S.length;O<Q;O++){D=S[O];M(D)}T=["prependTo","appendTo","insertAfter","insertBefore"];N=function(a){var b;b=B.fn[a];return B.fn[a]=function(){var a,c;a=1<=arguments.length?V.call(arguments,0):[];c=b.apply(this,a);t(this);return c}};for(P=0,R=T.length;P<R;P++){D=T[P];N(D)}G=B.cleanData;B.cleanData=function(b){var c,d,e,f;for(e=0,f=b.length;e<f;e++){c=b[e];d=a(c).view();if(d&&(d!=null?d[0]:void 0)===c){if(typeof d.beforeRemove==="function"){d.beforeRemove()}}}return G(b)};(typeof exports!=="undefined"&&exports!==null?exports:this).$$=function(a){return r.render.call(r,a)};(typeof exports!=="undefined"&&exports!==null?exports:this).$$$=function(a){return r.buildHtml.call(r,a)[0]};p.View=r;h=function(b){X(c,b);c.include(p.Events);c.prototype.eventSplitter=/^(\S+)\s*(.*)$/;c.prototype.tag="div";function c(b){this.destroy=Y(this.destroy,this);var d,e,f;this.options=b;f=this.options;for(d in f){e=f[d];this[d]=e}if(!this.el){this.el=document.createElement(this.tag)}this.el=a(this.el);this.$el=this.el;if(this.className){this.el.addClass(this.className)}if(this.attributes){this.el.attr(this.attributes)}if(!this.events){this.events=this.constructor.events}if(!this.elements){this.elements=this.constructor.elements}if(this.events){this.delegateEvents()}if(this.elements){this.refreshElements()}c.__super__.constructor.apply(this,arguments)}c.prototype.delegateEvents=function(){var a,b,c,d,e,f,g;f=this.events;g=[];for(b in f){d=f[b];if(typeof d!=="function"){d=this.proxy(this[d])}c=b.match(this.eventSplitter);a=c[1];e=c[2];if(e===""){g.push(this.el.bind(a,d))}else{g.push(this.el.delegate(e,a,d))}}return g};c.prototype.refreshElements=function(){var a,b,c,d;c=this.elements;d=[];for(a in c){b=c[a];d.push(this[b]=this.el.find(a))}return d};c.prototype.destroy=function(){this.trigger("release");this.el.addClass("garry");return this.unbind()};c.prototype.$=function(b){return a(b,this.el)};return c}(p.Module);p.Controller=h;g=function(a){X(b,a);function b(a){var b,c;if(a==null){a={}}for(b in a){c=a[b];this[b]=c}}b.prototype.all=function(){var a=this;return this.model.select(function(b){return a.associated(b)})};b.prototype.first=function(){return this.all()[0]};b.prototype.last=function(){var a;a=this.all();return a[a.length-1]};b.prototype.count=function(){return this.all().length};b.prototype.find=function(a){var b,c=this;b=this.select(function(b){return""+b.id===""+a});if(!b[0]){throw new Error('"'+this.model.className+'" model could not find a record for the ID "'+a+'"')}return b[0]};b.prototype.findAllBy=function(a,b){var c=this;return this.model.select(function(d){return c.associated(d)&&d[a]===b})};b.prototype.findBy=function(a,b){return this.findAllBy(a,b)[0]};b.prototype.select=function(a){var b=this;return this.model.select(function(c){return b.associated(c)&&a(c)})};b.prototype.refresh=function(a){var b,c,d,e,f,g,h,i,j,k,l;if(a==null){return this}k=this.all();for(e=0,g=k.length;e<g;e++){d=k[e];delete this.model.irecords[d.id];l=this.model.records;for(b=f=0,h=l.length;f<h;b=++f){c=l[b];if(!(c.id===d.id)){continue}this.model.records.splice(b,1);break}}if(!z(a)){a=[a]}for(j=0,i=a.length;j<i;j++){d=a[j];d.newRecord=false;d[this.fkey]=this.record.id}this.model.refresh(a);return this};b.prototype.create=function(a,b){a[this.fkey]=this.record.id;return this.model.create(a,b)};b.prototype.add=function(a,b){return a.updateAttribute(this.fkey,this.record.id,b)};b.prototype.remove=function(a,b){return a.updateAttribute(this.fkey,null,b)};b.prototype.associated=function(a){return a[this.fkey]===this.record.id};return b}(p.Module);l=function(a){X(b,a);function b(a){var b,c;if(a==null){a={}}for(b in a){c=a[b];this[b]=c}}b.prototype.exists=function(){if(this.record[this.fkey]){return this.model.exists(this.record[this.fkey])}else{return false}};b.prototype.update=function(a){if(a==null){return this}if(!(a instanceof this.model)){a=new this.model(a)}if(a.isNew()){a.save()}this.record[this.fkey]=a&&a.id;return this};return b}(p.Module);q=function(a){X(b,a);function b(a){var b,c;if(a==null){a={}}for(b in a){c=a[b];this[b]=c}}b.prototype.find=function(){return this.record.id&&this.model.findBy(this.fkey,this.record.id)};b.prototype.update=function(a){if(a==null){return this}if(!(a instanceof this.model)){a=this.model.fromJSON(a)}a[this.fkey]=this.record.id;a.save();return this};return b}(p.Module);I=function(a){return a.replace(/s$/,"")};K=function(a){return a.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()};s=function(a,b,c,d,e){if(typeof b==="string"){b=require(b)}return new e({name:a,model:b,record:c,fkey:d})};p.Collection=g;p.Singleton=q;p.Instance=l;p.Model.extend({hasMany:function(a,b,c){if(c==null){c=""+K(this.className)+"_id"}return this.prototype[a]=function(d){return s(a,b,this,c,p.Collection).refresh(d)}},belongsTo:function(a,b,c){if(c==null){c=""+K(I(a))+"_id"}this.prototype[a]=function(d){return s(a,b,this,c,p.Instance).update(d).exists()};return this.attributes.push(c)},hasOne:function(a,b,c){if(c==null){c=""+K(this.className)+"_id"}return this.prototype[a]=function(d){return s(a,b,this,c,p.Singleton).update(d).find()}}});f={setAttributesSnapshot:function(a){var b,c,d,e;b={};e=a.attributes();for(c in e){d=e[c];b[c]=d}return this._attributesSnapshots[a.id]=b},getAttributesSnapshot:function(a){return this._attributesSnapshots[a.id]}};c={extended:function(){var a=this;this._attributesSnapshots={};this.bind("refresh create",function(b){var c,d,e,f;b||(b=a.all());if(b.length!=null){f=[];for(d=0,e=b.length;d<e;d++){c=b[d];f.push(a.setAttributesSnapshot(c))}return f}else{return a.setAttributesSnapshot(b)}});this.bind("update",function(b){var c,d,e;e=b.attributes();for(c in e){d=e[c];if(!_.isEqual(a.getAttributesSnapshot(b)[c],d)){b.trigger("update:"+c)}}return a.setAttributesSnapshot(b)});return this.extend(f)}};p.AttributeTracking=c;x=/^#*/;F=/:([\w\d]+)/g;J=/\*([\w\d]+)/g;v=/[-[\]{}()+?.,\\^$|#\s]/g;p.Route=function(b){var c;X(d,b);d.extend(p.Events);d.historySupport=((c=window.history)!=null?c.pushState:void 0)!=null;d.routes=[];d.options={trigger:true,history:false,shim:false,replace:false,redirect:false};d.add=function(a,b){var c,d,e;if(typeof a==="object"&&!(a instanceof RegExp)){e=[];for(c in a){d=a[c];e.push(this.add(c,d))}return e}else{return this.routes.push(new this(a,b))}};d.setup=function(b){if(b==null){b={}}this.options=a.extend({},this.options,b);if(this.options.history){this.history=this.historySupport&&this.options.history}if(this.options.shim){return}if(this.history){a(window).bind("popstate",this.change)}else{a(window).bind("hashchange",this.change)}return this.change()};d.unbind=function(){if(this.options.shim){return}if(this.history){return a(window).unbind("popstate",this.change)}else{return a(window).unbind("hashchange",this.change)}};d.navigate=function(){var b,c,d,e,f;b=1<=arguments.length?V.call(arguments,0):[];d={};c=b[b.length-1];if(typeof c==="object"){d=b.pop()}else if(typeof c==="boolean"){d.trigger=b.pop()}d=a.extend({},this.options,d);e=b.join("/");if(this.path===e){return}this.path=e;this.trigger("navigate",this.path);if(d.trigger){f=this.matchRoute(this.path,d)}if(d.shim){return}if(!f){if(typeof d.redirect==="function"){return d.redirect.apply(this,[this.path,d])}else{if(d.redirect===true){this.redirect(this.path)}}}if(this.history&&d.replace){history.replaceState({},document.title,this.path)}else if(this.history){history.pushState({},document.title,this.path)}else{window.location.hash=this.path}return this};d.getEventName=function(){if(this.history){return"popstate"}else{return"hashchange"}};d.getPath=function(){var a;if(this.history){a=window.location.pathname;if(a.substr(0,1)!=="/"){a="/"+a}}else{a=window.location.hash;a=a.replace(x,"")}return a};d.getFragment=function(){return this.getHash().replace(x,"")};d.getHost=function(){return""+window.location.protocol+"//"+window.location.host};d.getHash=function(){return window.location.hash};d.change=function(){var a;a=this.getPath();if(a===this.path){return}this.path=a;this.matchRoute(this.path);return this};d.matchRoute=function(a,b){var c,d,e,f;f=this.routes;for(d=0,e=f.length;d<e;d++){c=f[d];if(!c.match(a,b)){continue}this.trigger("change",c,a);return c}};d.redirect=function(a){return window.location=a};function d(a,b){var c;this.path=a;this.callback=b;this.names=[];if(typeof a==="string"){F.lastIndex=0;while((c=F.exec(a))!==null){this.names.push(c[1])}J.lastIndex=0;while((c=J.exec(a))!==null){this.names.push(c[1])}a=a.replace(v,"\\$&").replace(F,"([^/]*)").replace(J,"(.*?)");this.route=new RegExp("^"+a+"$")}else{this.route=a}}d.prototype.match=function(a,b){var c,d,e,f,g,h;if(b==null){b={}}d=this.route.exec(a);if(!d){return false}b.match=d;f=d.slice(1);if(this.names.length){for(c=g=0,h=f.length;g<h;c=++g){e=f[c];b[this.names[c]]=e}}return this.callback.call(null,b)!==false};return d}(p.Module);p.Route.change=p.Route.proxy(p.Route.change);p.Controller.include({route:function(a,b){return p.Route.add(a,this.proxy(b))},routes:function(a){var b,c,d;d=[];for(b in a){c=a[b];d.push(this.route(b,c))}return d},url:function(){return p.Route.navigate.apply(p.Route,arguments)}});o=a({});m=p.Model;b={getURL:function(a){return(typeof a.url==="function"?a.url():void 0)||a.url},getCollectionURL:function(a){if(a){if(typeof a.url==="function"){return this.generateURL(a)}else{return a.url}}},getScope:function(a){return(typeof a.scope==="function"?a.scope():void 0)||a.scope},generateURL:function(){var a,c,d,e,f;d=arguments[0],a=2<=arguments.length?V.call(arguments,1):[];if(d.className){c=d.className.toLowerCase()+"s";f=b.getScope(d)}else{if(typeof d.constructor.url==="string"){c=d.constructor.url}else{c=d.constructor.className.toLowerCase()+"s"}f=b.getScope(d)||b.getScope(d.constructor)}a.unshift(c);a.unshift(f);e=a.join("/");e=e.replace(/(\/\/)/g,"/");e=e.replace(/^\/|\/$/g,"");if(e.indexOf("../")!==0){return m.host+"/"+e}else{return e}},enabled:true,disable:function(a){var b;if(this.enabled){this.enabled=false;try{return a()}catch(c){b=c;throw b}finally{this.enabled=true}}else{return a()}},queue:function(a){if(a){return o.queue(a)}else{return o.queue()}},clearQueue:function(){return this.queue([])}};d=function(){function c(){}c.prototype.defaults={dataType:"json",processData:false,headers:{"X-Requested-With":"XMLHttpRequest"}};c.prototype.queue=b.queue;c.prototype.ajax=function(b,c){return a.ajax(this.ajaxSettings(b,c))};c.prototype.ajaxQueue=function(c,d,e){var f,g,h,i,j;g=null;f=a.Deferred();h=f.promise();if(!b.enabled){return h}j=this.ajaxSettings(c,d);i=function(c){var d;if((e!=null?e.id:void 0)!=null){if(j.url==null){j.url=b.getURL(e)}if((d=j.data)!=null){d.id=e.id}}j.data=JSON.stringify(j.data);return g=a.ajax(j).done(f.resolve).fail(f.reject).then(c,c)};h.abort=function(b){var c;if(g){return g.abort(b)}c=a.inArray(i,this.queue());if(c>-1){this.queue().splice(c,1)}f.rejectWith(j.context||j,[h,b,""]);return h};this.queue(i);return h};c.prototype.ajaxSettings=function(b,c){return a.extend({},this.defaults,c,b)};return c}();g=function(a){X(c,a);function c(a){this.model=a;this.failResponse=Y(this.failResponse,this);this.recordsResponse=Y(this.recordsResponse,this)}c.prototype.find=function(a,c,d){var e;if(d==null){d={}}e=new this.model({id:a});return this.ajaxQueue(c,{type:"GET",url:d.url||b.getURL(e)}).done(this.recordsResponse).fail(this.failResponse)};c.prototype.all=function(a,c){if(c==null){c={}}return this.ajaxQueue(a,{type:"GET",url:c.url||b.getURL(this.model)}).done(this.recordsResponse).fail(this.failResponse)};c.prototype.fetch=function(a,b){var c,d=this;if(a==null){a={}}if(b==null){b={}}if(c=a.id){delete a.id;return this.find(c,a,b).done(function(a){return d.model.refresh(a,b)})}else{return this.all(a,b).done(function(a){return d.model.refresh(a,b)})}};c.prototype.recordsResponse=function(a,b,c){return this.model.trigger("ajaxSuccess",null,b,c)};c.prototype.failResponse=function(a,b,c){return this.model.trigger("ajaxError",null,a,b,c)};return c}(d);q=function(a){X(c,a);function c(a){this.record=a;this.failResponse=Y(this.failResponse,this);this.recordResponse=Y(this.recordResponse,this);this.model=this.record.constructor}c.prototype.reload=function(a,b){if(b==null){b={}}return this.ajaxQueue(a,{type:"GET",url:b.url},this.record).done(this.recordResponse(b)).fail(this.failResponse(b))};c.prototype.create=function(a,c){if(c==null){c={}}return this.ajaxQueue(a,{type:"POST",contentType:"application/json",data:this.record.toJSON(),url:c.url||b.getCollectionURL(this.record)}).done(this.recordResponse(c)).fail(this.failResponse(c))};c.prototype.update=function(a,b){if(b==null){b={}}return this.ajaxQueue(a,{type:"PUT",contentType:"application/json",data:this.record.toJSON(),url:b.url},this.record).done(this.recordResponse(b)).fail(this.failResponse(b))};c.prototype.destroy=function(a,b){if(b==null){b={}}return this.ajaxQueue(a,{type:"DELETE",url:b.url},this.record).done(this.recordResponse(b)).fail(this.failResponse(b))
};c.prototype.recordResponse=function(a){var c=this;if(a==null){a={}}return function(d,e,f){var g,h;b.disable(function(){if(!(A(d)||c.record.destroyed)){if(d.id&&c.record.id!==d.id){c.record.changeID(d.id)}return c.record.refresh(d)}});c.record.trigger("ajaxSuccess",d,e,f);if((g=a.success)!=null){g.apply(c.record)}return(h=a.done)!=null?h.apply(c.record):void 0}};c.prototype.failResponse=function(a){var b=this;if(a==null){a={}}return function(c,d,e){var f,g;b.record.trigger("ajaxError",c,d,e);if((f=a.error)!=null){f.apply(b.record)}return(g=a.fail)!=null?g.apply(b.record):void 0}};return c}(d);m.host="";k={ajax:function(){return new q(this)},url:function(){var a;a=1<=arguments.length?V.call(arguments,0):[];a.unshift(encodeURIComponent(this.id));return b.generateURL.apply(b,[this].concat(V.call(a)))}};j={ajax:function(){return new g(this)},url:function(){var a;a=1<=arguments.length?V.call(arguments,0):[];return b.generateURL.apply(b,[this].concat(V.call(a)))}};m.Ajax={extended:function(){this.fetch(this.ajaxFetch);this.change(this.ajaxChange);this.extend(j);return this.include(k)},ajaxFetch:function(){var a;return(a=this.ajax()).fetch.apply(a,arguments)},ajaxChange:function(a,b,c){if(c==null){c={}}if(c.ajax===false){return}return a.ajax()[b](c.ajax,c)}};m.Ajax.Methods={extended:function(){this.extend(j);return this.include(k)}};b.defaults=d.prototype.defaults;b.Base=d;b.Singleton=q;b.Collection=g;p.Ajax=b}).call(this);